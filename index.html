<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href="draughtsboard.css" rel="stylesheet"/>
    <title>Draughtsboard</title>
  </head>
  <body>
    <h2>Draughts board</h2>
    <div id="board" style="width: 600px; height: 600px"></div>
    <textarea id="pdn">
[Event "18th Computer Olympiad, 10x10 Draughts"]
[Site "Leiden, NLD"]
[Date "2015.07.04"]
[Round "1"]
[White "Scan"]
[Black "Moby Dam (Jun 30 2015)"]
[Result "1-0"]

1. 34-30 19-23 2. 30-25 20-24 3. 33-29 24x33 4. 39x19 14x23 5. 40-34 9-14 6.
44-39 14-20 7. 25x14 10x19 8. 50-44 5-10 9. 38-33 10-14 10. 42-38 23-28 11.
32x23 18x40 12. 45x34 12-18 13. 35-30 7-12 14. 37-32 18-23 15. 44-40 12-18 16.
41-37 1-7 17. 46-41 7-12 18. 47-42 23-28 19. 33x22 17x28 20. 32x23 19x28 21.
38-32 13-19 22. 32x23 19x28 23. 43-38 8-13 24. 38-32 13-19 25. 32x23 19x28 26.
42-38 11-17 27. 31-27 6-11 28. 38-33 18-23 29. 33x22 17x28 30. 37-31 11-17 31.
27-22 28-32 32. 22x11 16x7 33. 48-42 12-18 34. 31-26 2-8 35. 36-31 7-12 36.
40-35 15-20 37. 49-43 23-28 38. 34-29 12-17 39. 30-24 20-25 40. 42-38 25-30
41. 38x27 30x19 42. 41-36 28-32 43. 27x38 19-23 44. 31-27 23x34 45. 39x30 8-12
46. 30-24 3-8 47. 43-39 18-23 48. 27-21 23-28 49. 36-31 8-13 50. 35-30 14-19
51. 21-16 12-18 52. 31-27 19-23 53. 38-33 28-32 54. 27x38 18-22 55. 24-20
22-27 56. 30-24 17-21 57. 26x17 27-31 58. 17-12 31-36 59. 12-7 36-41 60. 38-32
13-18 61. 7-2 23-29 62. 2-13 29x27 63. 13x47 4-10 64. 24-19 10-15 65. 47-24
1-0
    </textarea>
    <textarea id="fen">
W:W13,K22,25,33,35,44,K45,46:B1,2,3,6,9,10,12,14,16,20,21,K49
    </textarea>
    <textarea id="fen2">
W:W13,K22,25,32:B1,2,3,6,K9,12,11
    </textarea>
    <script src="//code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="//github.com/shubhendusaurabh/draughts.js/blob/master/draughts.js"></script>
    <script src="//github.com/shubhendusaurabh/draughtsboardJS/blob/master/draughtsboard.js"></script>
    <script>

    var sample = '';
    sample += '[Event "NK 2009, ronde 12, 17 april"]' + '\n';
    sample += '[Site "nk2009.dvvbi.nl"]' + '\n';
    sample += '[Date "17 april 2009"]' + '\n';
    sample += '[Round "12"]' + '\n';
    sample += '[White "Jeroen van den Akker"]' + '\n';
    sample += '[Black "Roel Boomstra"]' + '\n';
    sample += '[Result "1-1"]' + '\n';
    sample += '' + '\n';
    sample += '1. 32-28 17-22  2. 28x17 11x22  3. 37-32  6-11  4. 41-37 12-17  5. 46-41  8-12' + '\n';
    sample += '6. 34-29 19-23  7. 40-34 14-19  8. 45-40 10-14  9. 32-28 23x32 10. 37x28  5-10' + '\n';
    sample += '11. 41-37 20-24 12. 29x20 15x24 13. 34-30 16-21 14. 31-26 11-16 15. 37-31  1-6 ' + '\n';
    sample += '16. 40-34  7-11 17. 30-25  2-7  18. 34-30  3-8  19. 39-34 18-23 20. 47-41 23x32' + '\n';
    sample += '21. 38x18 12x23 22. 34-29 23x34 23. 30x39  7-12 24. 43-38 19-23 25. 41-37 13-18' + '\n';
    sample += '26. 37-32 24-29 27. 33x24 23-28 28. 32x23 18x20 29. 42-37 20-24 30. 37-32 12-18' + '\n';
    sample += '31. 39-33  8-13 32. 49-43 18-22 33. 32-27 21x32 34. 38x18 13x22 35. 31-27 22x31' + '\n';
    sample += '36. 26x37 14-19 37. 43-38 19-23 38. 48-42 10-14 39. 44-40  9-13 40. 40-34 23-28' + '\n';
    sample += '41. 33x22 17x28 42. 50-44 11-17 43. 34-29 24x33 44. 38x29 16-21 45. 44-39 17-22' + '\n';
    sample += '46. 42-38 21-27 47. 35-30  6-11 48. 30-24 11-17 49. 38-33 13-18 50. 37-31 28-32' + '\n';
    sample += '51. 24-20 14-19 52. 29-24 19x30 53. 25x34 17-21 54. 33-28 22x44 55. 31x13 44-50' + '\n';
    sample += '56. 13-8  32-38 57.  8-2  38-43 58. 20-14 43-48 59.  2-16 48x3  60. 16x32  3-26' + '\n';
    sample += '1-1' + '\n' + '\n';

var game = new Draughts();

// Draughtsboard start
var boardEl = $('#board');
var squareToHighlight;
var orientation;
var gameStatus = 'stopped';

var removeHighlights = function (color) {
  boardEl.find('.square-55d63').removeClass('highlight-' + color);
};

var unHighlightMoves = function () {
  $('#board .square-55d63').css('background', '');
};

var highlightMoves = function (square) {
  var squareEl = $('#board .square-' + square);

  var background = '#a9a9a9';
  if (squareEl.hasClass('black-3c85d')) {
    background = '#696969';
  }
  squareEl.css('background', background);
};

var onDragStart = function (source, piece, position) {
  console.log(game.gameOver());
  if (gameStatus == 'stopped' || game.turn() != orientation) {
    return false;
  }
  if (game.gameOver() == true || (game.turn() == 'w' && piece.search('/^b/') !== -1) || game.turn() === 'b' && piece.search('/^w/') !== -1) {
    return false;
  }
};

var onDrop = function(source, target) {
  unHighlightMoves();
  var move = game.move({
    from: source,
    to: target
  });
// console.log(move, source, target);
  if (move === null) {
    return 'snapback';
  }
//   console.log(move);
  // socket.emit('move', {from: source, to: target, promotion: 'q'});
  // remove black highlights
  removeHighlights('black');
  boardEl.find('.square-' + move.from).addClass('highlight-black');
  squareToHighlight = move.to;

  // remove white highlights
  // highlight white's move
  removeHighlights('white');
  boardEl.find('.square-' + source).addClass('highlight-white');
  boardEl.find('.square-' + target).addClass('highlight-white');
};

var onSnapEnd = function () {
  board.position(game.fen());
}

var onMouseoverSquare = function (square, piece) {
  if (!piece) {
    return false;
  }
  var moves = game.moves({
    square: square,
    verbose: true
  });

  if (moves.length === 0) {
    return false;
  }

  highlightMoves(square);

  moves.forEach(function(move) {
    highlightMoves(move.to);
  });
};

var onMouseoutSquare = function (square, piece) {
  unHighlightMoves();
}

var updateStatus = function(move) {
  var status = '';

  var moveColor = 'White';
  if (game.turn() === 'b') {
    moveColor = 'Black';
  }

  if (game.gameOver() === true) {
    status = 'Game over, ' + moveColor + ' is in checkmate.';
  }

}

var onMoveEnd = function() {
  boardEl.find('.square-' + squareToHighlight).addClass('highlight-black');
};
var board;

var initialConfig = {
  showNotation: true,
  position: 'start',
  draggable: true,
  pieceTheme: 'unicode',
  showErrors: 'console',
  ondragstart: onDragStart,
  onDrop: onDrop,
  onSnapEnd: onSnapEnd,
  onMouseoutSquare: onMouseoutSquare,
  onMouseoverSquare: onMouseoverSquare,
  onMoveEnd: onMoveEnd
};

board = DraughtsBoard('board', initialConfig);
    </script>
  </body>
</html>
